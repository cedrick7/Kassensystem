{% extends 'base.html' %}
{% load static %}
{% load bootstrap4 %}
{% load widget_tweaks %}

<!-- Head -->
{% block specific %}
<title>Analyst - Dashboard</title>

<link rel="stylesheet" type="text/css" href="{% static 'css/toggle-switch.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/analyzation_navbar.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/analyzation_styles.css' %}" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/lightpick@1.3.4/css/lightpick.min.css" />
{% endblock specific %}

<!-- Body -->
{% block navbar %}
    {% include 'analyzation_navbar.html' %}
{% endblock navbar %}

{% block content %}
<section id="body" url-endpoint='{% url "api-dashboard-chart-data" %}'>
    <div class="heading container-fluid">
        <!-- change this content -->
        <h3>Dashboard</h3>
    </div>
    <div class="content container-fluid">

        <!-- Einnahmen (Monat, Woche, Heute) [card] -->
        <div class="row-card row">
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Einnahmen (Monat)</span></div>
                    <div class="text-2"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-euro-sign fa-2x"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Einnahmen (Woche)</span></div>
                    <div class="text-2"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-euro-sign fa-2x"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Einnahmen (Heute)</span></div>
                    <div class="text-2"><span>40,000€</span></div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-euro-sign fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Produkte, Dienstleistungen, Kunden (Heute) [card] -->
        <div class="row-card row">
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Produkte (Heute)</span></div>
                    <div class="text-2"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-tags fa-2x"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Dienstleistungen (Heute)</span></div>
                    <div class="text-2"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-hands-helping fa-2x"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-4">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="text-1"><span>Kunden (Heute)</span></div>
                    <div class="text-2"><span>40,000€</span></div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-users fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Kassen (Online-Status, Mitarbeitername, Kasseninhalt) [card] -->
        <div class="row-card row">
          <div class="col-card col-12 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="cashbox-heading"><span>Kasse #1</span></div>
                    <div class="text-3"><span>Mitarbeitername 1</span></div>
                    <div class="text-4"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-circle fa-2x status-online"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="cashbox-heading"><span>Kasse #2</span></div>
                    <div class="text-3"><span>Mitarbeitername 2</span></div>
                    <div class="text-4"><span>40.000€</span></div>
                  </div>
                  <div class="col-auto"><i class="fas fa-circle fa-2x status-online"></i></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-card col-12 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <div class="cashbox-heading"><span>Kasse #3</span></div>
                    <div class="text-3"><span>-</span></div>
                    <div class="text-4"><span>-</span></div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-circle fa-2x status-offline"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Umsatz Überblick [line-chart] -->
        <div class="row-chart row">
          <div class="col-chart col-12">
            <div class="card">
              <div class="card-header">
              <!-- change this content -->
              <p>Umsatz Überblick</p>
            </div>
              <div class="card-body">
                  <div class="row">
                      <div class="col-12 col-xl-6 col-filter">
                          <div class="accordion-filter" role="tablist" id="accordion-1">
                              <div class="card">
                                <div class="card-header" role="tab">
                                  <a data-toggle="collapse" aria-expanded="false" aria-controls="accordion-1 .item-1" href="#accordion-1 .item-1">Filtereinstellungen<i class="fas fa-caret-down"></i></a>
                                </div>
                                <div class="collapse item-1" role="tabpanel" data-parent="#accordion-1">
                                  <div class="card-body">
                                    <form class="">

                                      <!-- Daterange -->
                                      <div class="form-group date-select col-12 col-md-8">
                                        <div class="input-group input-daterange">
                                          <div class="input-group-prepend">
                                            <span class="input-group-text">Zeitraum</span>
                                          </div>
                                          <input class="form-control" type="text" id="dateRangePicker" placeholder="18.08.2020 bis 23.08.2020">
                                        </div>
                                      </div>

                                      <!-- Anzeigeoptionen -->
                                      <div class="form-group selection-select col-12 col-md-8">
                                        <div class="input-group input-daterange">
                                          <div class="input-group-prepend">
                                            <span class="input-group-text">Anzeigen</span>
                                          </div>
                                          <select class="form-control">
                                            <optgroup label="Anzeigeoptionen">
                                              <option value="1" selected>Alle</option>
                                              <option value="2">Nur Produkte</option>
                                              <option value="3">Nur Dienstleistungen</option>
                                            </optgroup>
                                          </select>
                                        </div>
                                      </div>

                                      <!-- Durchschnittsvergleich -->
                                      <div class="form-group comparison-select col-12 col-md-8">
                                        <div class="input-group input-daterange">
                                          <div class="input-group-prepend">
                                              <span class="input-group-text">Durchschnitts-Vergleich</span>
                                          </div>
                                            <label class="switch">
                                              <input type="checkbox">
                                              <span class="slider round"></span>
                                            </label>
                                        </div>
                                      </div>

                                      <!-- Submit -->
                                      <div class="form-group col-6 col-md-4">
                                          <button class="btn btn-primary btn-block" type="submit">Filtern!</button>
                                      </div>

                                    </form>
                                  </div>
                                </div>
                              </div>
                          </div>
                      </div>
                      <div class="col col-chart">
                          <div class="chart-area">
                              <div class="chart line-chart">
                                  <canvas id="revenueChartData" width="500" height="400"></canvas>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Produkte Überblick und Dienstleistungen Überblick (TOP-X Ranking) [bar-chart] -->
        <div class="row-chart row">
          <div class="col-chart col-12 col-md-6">
            <div class="card">
              <div class="card-header">
              <!-- change this content -->
              <p>Produkte Überblick</p>
            </div>
              <div class="card-body">
                  <div class="row">
                      <div class="col col-chart">
                          <div class="chart-area">
                              <div class="chart bar-chart">
                                  <canvas id="productsChartData" width="500" height="400"></canvas>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
          <div class="col-chart col-12 col-md-6">
            <div class="card">
              <div class="card-header">
              <!-- change this content -->
              <p>Dienstleistungen Überblick</p>
            </div>
              <div class="card-body">
                  <div class="row">
                      <div class="col col-chart">
                          <div class="chart-area">
                              <div class="chart bar-chart">
                                  <canvas id="servicesChartData" width="500" height="400"></canvas>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>

    </div>
</section>
{% endblock content %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightpick@1.3.4/lightpick.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"></script>

<script type="text/javascript" src="{% static 'js/smart-forms.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/datepicker.js' %}"></script>
<script type="text/javascript" src="{% static 'js/analyzation_navbar.js' %}"></script>
{% endblock javascript %}

<!-- Chart.js -->
{% block chart.js %}
<script>
    const endpoint = '{% url "api-dashboard-chart-data" %}'
    var revenue_labels = []
    var revenue_data = []
    var products_labels = []
    var products_data = []
    var services_labels = []
    var services_data = []
    $.ajax({
        method: "GET",
        url: endpoint,
        success: function (data) {
            revenue_labels = data.revenue_labels
            revenue_data = data.revenue_data
            products_labels = data.products_labels
            products_data = data.products_data
            services_labels = data.services_labels
            services_data = data.services_data
            setChart()
            console.log(data)
        },
        error: function (error_data) {
            console.log("error")
            console.log(error_data)
        }
    })

    function setChart() {

        // Umsatz
        var revenueChartData = document.getElementById("revenueChartData");
        var revenueChart = new Chart(revenueChartData, {
            type: 'line',
            data: {
                labels: revenue_labels,
                datasets: [{
                    label: '',
                    data: revenue_data,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255,99,132,1)',
                    borderWidth: 1,
                    pointBackgroundColor: 'rgba(255, 99, 132, 0.2)',
                    pointBorderColor: 'rgba(255, 99, 132, 1)',
                    fill: true
                }]
            },
            options: {
				responsive: true,
				title: {
					display: true,
					text: 'Umsatz'
				},
                legend: {
                    display: false
                },
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Zeit'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Umsatz in €'
						},
                        ticks: {
                            beginAtZero: true
                        }
					}]
				}
			}
        });

        // Produkte
        var productsChartData = document.getElementById("productsChartData");
        var productsChart = new Chart(productsChartData, {
            type: 'bar',
            data: {
                labels: products_labels,
                datasets: [{
                    label: 'TOP 5 Kategorien',
                    data: products_data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
				responsive: true,
				title: {
					display: true,
					text: 'TOP 5 Kategorien'
				},
                legend: {
                    display: false
                },
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Kategorie'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Anzahl Verkäufe'
						},
                        ticks: {
                            beginAtZero: true
                        }
					}]
				}
			}
        });

        // Dienstleistungen
        var servicesChartData = document.getElementById("servicesChartData");
        var servicesChart = new Chart(servicesChartData, {
            type: 'bar',
            data: {
                labels: services_labels,
                datasets: [{
                    label: 'TOP 5 Kategorien',
                    data: services_data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
				responsive: true,
				title: {
					display: true,
					text: 'TOP 5 Kategorien'
				},
                legend: {
                    display: false
                },
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Kategorie'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Anzahl Verkäufe'
						},
                        ticks: {
                            beginAtZero: true
                        }
					}]
				}
			}
        });
    }
</script>
{% endblock chart.js %}